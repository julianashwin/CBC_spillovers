print(stab_varone)
plot(stab_varone)
varone_oirf <- oirf(var_std, n.ahead = 12)
plot(varone_oirf)
varone_girf <- girf(var_std, n.ahead = 12, ma_approx_steps = 12)
plot(varone_girf)
#### Manually bootstrap CIs
## Options
individuals <- unique(total.df$variable)
ndraws <- 5000
n_ahead <- 12
nlags <- 3
oirf_draws <- data.frame(draw = 1:ndraws)
# Dispersion shock
oirf_draws[,c(paste0("disp_on_disp_", 1:n_ahead),paste0("disp_on_news_", 1:n_ahead),
paste0("disp_on_fed_", 1:n_ahead))] <- 0
# News shock
oirf_draws[,c(paste0("news_on_disp_", 1:n_ahead),paste0("news_on_news_", 1:n_ahead),
paste0("news_on_fed_", 1:n_ahead))] <- 0
# FOMC shock
oirf_draws[,c(paste0("fed_on_disp_", 1:n_ahead),paste0("fed_on_news_", 1:n_ahead),
paste0("fed_on_fed_", 1:n_ahead))] <- 0
girf_draws <- oirf_draws
pb = txtProgressBar(min = 1, max = ndraws, initial = 1)
for (nn in 1:ndraws){
setTxtProgressBar(pb,nn)
# Blockwise sample individuals
sub_inds <- sample(individuals, length(individuals), replace = TRUE)
sub.df <- total.df[which(total.df$variable == sub_inds[1]),]
for (si in sub_inds[2:length(sub_inds)]){
sub.df <- rbind(sub.df, total.df[which(total.df$variable == si),])
}
# Estimate VAR by OLS
var_sub <- pvarfeols(
dependent_vars = c("disp_std","news_std","mins_std"),
lags = nlags,
#exog_vars,
transformation = c("fod"),
data = sub.df,
panel_identifier = c("variable", "period")
)
# Compute IRFs
varsub_oirf <- oirf(var_sub, n.ahead = n_ahead)
varsub_girf <- girf(var_sub, n.ahead = n_ahead, ma_approx_steps = n_ahead)
# Save OIRF results for disp shock
oirf_draws[nn,paste0("disp_on_disp_", 1:n_ahead)] <- varsub_oirf$disp_std[,"disp_std"]
oirf_draws[nn,paste0("disp_on_news_", 1:n_ahead)] <- varsub_oirf$disp_std[,"news_std"]
oirf_draws[nn,paste0("disp_on_fed_", 1:n_ahead)] <- varsub_oirf$disp_std[,"mins_std"]
# Save OIRF results for news shock
oirf_draws[nn,paste0("news_on_disp_", 1:n_ahead)] <- varsub_oirf$news_std[,"disp_std"]
oirf_draws[nn,paste0("news_on_news_", 1:n_ahead)] <- varsub_oirf$news_std[,"news_std"]
oirf_draws[nn,paste0("news_on_fed_", 1:n_ahead)] <- varsub_oirf$news_std[,"mins_std"]
# Save OIRF results for fed shock
oirf_draws[nn,paste0("fed_on_disp_", 1:n_ahead)] <- varsub_oirf$mins_std[,"disp_std"]
oirf_draws[nn,paste0("fed_on_news_", 1:n_ahead)] <- varsub_oirf$mins_std[,"news_std"]
oirf_draws[nn,paste0("fed_on_fed_", 1:n_ahead)] <- varsub_oirf$mins_std[,"mins_std"]
# Save GIRF results for disp shock
girf_draws[nn,paste0("disp_on_disp_", 1:n_ahead)] <- varsub_girf$disp_std[,"disp_std"]
girf_draws[nn,paste0("disp_on_news_", 1:n_ahead)] <- varsub_girf$disp_std[,"news_std"]
girf_draws[nn,paste0("disp_on_fed_", 1:n_ahead)] <- varsub_girf$disp_std[,"mins_std"]
# Save OIRF results for news shock
girf_draws[nn,paste0("news_on_disp_", 1:n_ahead)] <- varsub_girf$news_std[,"disp_std"]
girf_draws[nn,paste0("news_on_news_", 1:n_ahead)] <- varsub_girf$news_std[,"news_std"]
girf_draws[nn,paste0("news_on_fed_", 1:n_ahead)] <- varsub_girf$news_std[,"mins_std"]
# Save OIRF results for fed shock
girf_draws[nn,paste0("fed_on_disp_", 1:n_ahead)] <- varsub_girf$mins_std[,"disp_std"]
girf_draws[nn,paste0("fed_on_news_", 1:n_ahead)] <- varsub_girf$mins_std[,"news_std"]
girf_draws[nn,paste0("fed_on_fed_", 1:n_ahead)] <- varsub_girf$mins_std[,"mins_std"]
}
### Plot IRFs with bootstrapped CIs
varobj <- varone_oirf
btstrpobj <- oirf_draws
name <- "disp_on_fed_"
create_btsrp_df <- function(n_ahead,btstrpobj,name){
btstrp_df <- data.frame(period = 0:(n_ahead-1))
btstrp_df[,c("quant_0p025", "quant_0p975", "quant_0p5", "quant_0p15", "quant_0p85")] <- 0
for (ll in 1:n_ahead){
btstrp_dist <- btstrpobj[,paste0(name, ll)]
btstrp_df$quant_0p025[ll] <- quantile(btstrp_dist, probs = c(0.025))
btstrp_df$quant_0p975[ll] <- quantile(btstrp_dist, probs = c(0.975))
btstrp_df$quant_0p15[ll] <- quantile(btstrp_dist, probs = c(0.15))
btstrp_df$quant_0p85[ll] <- quantile(btstrp_dist, probs = c(0.85))
btstrp_df$quant_0p5[ll] <- quantile(btstrp_dist, probs = c(0.5))
}
return(btstrp_df)
}
plt_btstrp <- function(btstrp_df){
p1 <- ggplot(btstrp_df,aes(x=period)) + geom_line(aes(y=quant_0p5)) + theme_bw() +
xlab("Periods") + ylab("Response") + geom_hline(yintercept = 0, linetype = 2) +
geom_ribbon(aes(ymin = quant_0p025, ymax = quant_0p975), fill= "black", alpha = 0.2) +
geom_ribbon(aes(ymin = quant_0p15, ymax = quant_0p85), fill = "black", alpha = 0.4) +
scale_x_continuous(breaks= pretty_breaks())
return(p1)
}
btstrp_df <- create_btsrp_df(n_ahead,oirf_draws,"disp_on_disp_")
plt_btstrp(btstrp_df) + ggtitle("SPF dispersion on SPF dispersion")
ggsave("figures/IRFs/disp/spf_spf.pdf", width = 4, height = 3)
btstrp_df <- create_btsrp_df(n_ahead,oirf_draws,"disp_on_news_")
plt_btstrp(btstrp_df) + ggtitle("SPF dispersion on NYT focus")
ggsave("figures/IRFs/disp/spf_nyt.pdf", width = 4, height = 3)
btstrp_df <- create_btsrp_df(n_ahead,oirf_draws,"disp_on_fed_")
plt_btstrp(btstrp_df) + ggtitle("SPF dispersion on FOMC minutes focus")
ggsave("figures/IRFs/disp/spf_fomc.pdf", width = 4, height = 3)
btstrp_df <- create_btsrp_df(n_ahead,oirf_draws,"news_on_disp_")
plt_btstrp(btstrp_df) + ggtitle("NYT focus on SPF dispersion")
ggsave("figures/IRFs/disp/nyt_spf.pdf", width = 4, height = 3)
btstrp_df <- create_btsrp_df(n_ahead,oirf_draws,"news_on_news_")
plt_btstrp(btstrp_df) + ggtitle("NYT focus on NYT focus")
ggsave("figures/IRFs/disp/nyt_nyt.pdf", width = 4, height = 3)
btstrp_df <- create_btsrp_df(n_ahead,oirf_draws,"news_on_fed_")
plt_btstrp(btstrp_df) + ggtitle("NYT focus on FOMC minutes focus")
ggsave("figures/IRFs/disp/nyt_fomc.pdf", width = 4, height = 3)
btstrp_df <- create_btsrp_df(n_ahead,oirf_draws,"fed_on_disp_")
plt_btstrp(btstrp_df) + ggtitle("FOMC minutes focus on SPF dispersion")
ggsave("figures/IRFs/disp/fomc_spf.pdf", width = 4, height = 3)
btstrp_df <- create_btsrp_df(n_ahead,oirf_draws,"fed_on_news_")
plt_btstrp(btstrp_df) + ggtitle("FOMC minutes focus on NYT focus")
ggsave("figures/IRFs/disp/fomc_nyt.pdf", width = 4, height = 3)
btstrp_df <- create_btsrp_df(n_ahead,oirf_draws,"fed_on_fed_")
plt_btstrp(btstrp_df) + ggtitle("FOMC minutes focus on FOMC minutes focus")
ggsave("figures/IRFs/disp/fomc_fomc.pdf", width = 4, height = 3)
individuals <- unique(total.df$variable)
ndraws <- 5000
n_ahead <- 12
nlags <- 3
## Store results
oirf_draws <- data.frame(draw = 1:ndraws)
# Dispersion shock
oirf_draws[,c(paste0("disp_on_disp_", 1:n_ahead),paste0("disp_on_news_", 1:n_ahead),
paste0("disp_on_fed_", 1:n_ahead))] <- 0
# News shock
oirf_draws[,c(paste0("news_on_disp_", 1:n_ahead),paste0("news_on_news_", 1:n_ahead),
paste0("news_on_fed_", 1:n_ahead))] <- 0
# FOMC shock
oirf_draws[,c(paste0("fed_on_disp_", 1:n_ahead),paste0("fed_on_news_", 1:n_ahead),
paste0("fed_on_fed_", 1:n_ahead))] <- 0
girf_draws <- oirf_draws
individuals <- unique(total.df$variable)
ndraws <- 5000
n_ahead <- 12
nlags <- 3
## Store results
oirf_draws <- data.frame(draw = 1:ndraws)
# Dispersion shock
oirf_draws[,c(paste0("disp_on_disp_", 1:n_ahead),paste0("disp_on_news_", 1:n_ahead),
paste0("disp_on_fed_", 1:n_ahead))] <- 0
# News shock
oirf_draws[,c(paste0("news_on_disp_", 1:n_ahead),paste0("news_on_news_", 1:n_ahead),
paste0("news_on_fed_", 1:n_ahead))] <- 0
# FOMC shock
oirf_draws[,c(paste0("fed_on_disp_", 1:n_ahead),paste0("fed_on_news_", 1:n_ahead),
paste0("fed_on_fed_", 1:n_ahead))] <- 0
girf_draws <- oirf_draws
pb = txtProgressBar(min = 1, max = ndraws, initial = 1)
for (nn in 1:ndraws){
setTxtProgressBar(pb,nn)
# Blockwise sample individuals
sub_inds <- sample(individuals, length(individuals), replace = TRUE)
sub.df <- total.df[which(total.df$variable == sub_inds[1]),]
for (si in sub_inds[2:length(sub_inds)]){
sub.df <- rbind(sub.df, total.df[which(total.df$variable == si),])
}
sub.df$disp_std <- sub.df$GB_SPF_now_gap_abs_std
# Estimate VAR by OLS
var_sub <- pvarfeols(
dependent_vars = c("disp_std","news_std","mins_std"),
lags = nlags,
#exog_vars,
transformation = c("fod"),
data = sub.df,
panel_identifier = c("variable", "period")
)
# Compute IRFs
varsub_oirf <- oirf(var_sub, n.ahead = n_ahead)
varsub_girf <- girf(var_sub, n.ahead = n_ahead, ma_approx_steps = n_ahead)
# Save OIRF results for disp shock
oirf_draws[nn,paste0("disp_on_disp_", 1:n_ahead)] <- varsub_oirf$disp_std[,"disp_std"]
oirf_draws[nn,paste0("disp_on_news_", 1:n_ahead)] <- varsub_oirf$disp_std[,"news_std"]
oirf_draws[nn,paste0("disp_on_fed_", 1:n_ahead)] <- varsub_oirf$disp_std[,"mins_std"]
# Save OIRF results for news shock
oirf_draws[nn,paste0("news_on_disp_", 1:n_ahead)] <- varsub_oirf$news_std[,"disp_std"]
oirf_draws[nn,paste0("news_on_news_", 1:n_ahead)] <- varsub_oirf$news_std[,"news_std"]
oirf_draws[nn,paste0("news_on_fed_", 1:n_ahead)] <- varsub_oirf$news_std[,"mins_std"]
# Save OIRF results for fed shock
oirf_draws[nn,paste0("fed_on_disp_", 1:n_ahead)] <- varsub_oirf$mins_std[,"disp_std"]
oirf_draws[nn,paste0("fed_on_news_", 1:n_ahead)] <- varsub_oirf$mins_std[,"news_std"]
oirf_draws[nn,paste0("fed_on_fed_", 1:n_ahead)] <- varsub_oirf$mins_std[,"mins_std"]
# Save GIRF results for disp shock
girf_draws[nn,paste0("disp_on_disp_", 1:n_ahead)] <- varsub_girf$disp_std[,"disp_std"]
girf_draws[nn,paste0("disp_on_news_", 1:n_ahead)] <- varsub_girf$disp_std[,"news_std"]
girf_draws[nn,paste0("disp_on_fed_", 1:n_ahead)] <- varsub_girf$disp_std[,"mins_std"]
# Save OIRF results for news shock
girf_draws[nn,paste0("news_on_disp_", 1:n_ahead)] <- varsub_girf$news_std[,"disp_std"]
girf_draws[nn,paste0("news_on_news_", 1:n_ahead)] <- varsub_girf$news_std[,"news_std"]
girf_draws[nn,paste0("news_on_fed_", 1:n_ahead)] <- varsub_girf$news_std[,"mins_std"]
# Save OIRF results for fed shock
girf_draws[nn,paste0("fed_on_disp_", 1:n_ahead)] <- varsub_girf$mins_std[,"disp_std"]
girf_draws[nn,paste0("fed_on_news_", 1:n_ahead)] <- varsub_girf$mins_std[,"news_std"]
girf_draws[nn,paste0("fed_on_fed_", 1:n_ahead)] <- varsub_girf$mins_std[,"mins_std"]
}
varobj <- varone_oirf
btstrpobj <- oirf_draws
name <- "disp_on_fed_"
create_btsrp_df <- function(n_ahead,btstrpobj,name){
btstrp_df <- data.frame(period = 0:(n_ahead-1))
btstrp_df[,c("quant_0p025", "quant_0p975", "quant_0p5", "quant_0p15", "quant_0p85")] <- 0
for (ll in 1:n_ahead){
btstrp_dist <- btstrpobj[,paste0(name, ll)]
btstrp_df$quant_0p025[ll] <- quantile(btstrp_dist, probs = c(0.025))
btstrp_df$quant_0p975[ll] <- quantile(btstrp_dist, probs = c(0.975))
btstrp_df$quant_0p15[ll] <- quantile(btstrp_dist, probs = c(0.15))
btstrp_df$quant_0p85[ll] <- quantile(btstrp_dist, probs = c(0.85))
btstrp_df$quant_0p5[ll] <- quantile(btstrp_dist, probs = c(0.5))
}
return(btstrp_df)
}
plt_btstrp <- function(btstrp_df){
p1 <- ggplot(btstrp_df,aes(x=period)) + geom_line(aes(y=quant_0p5)) + theme_bw() +
xlab("Periods") + ylab("Response") + geom_hline(yintercept = 0, linetype = 2) +
geom_ribbon(aes(ymin = quant_0p025, ymax = quant_0p975), fill= "black", alpha = 0.2) +
geom_ribbon(aes(ymin = quant_0p15, ymax = quant_0p85), fill = "black", alpha = 0.4) +
scale_x_continuous(breaks= pretty_breaks())
return(p1)
}
btstrp_df <- create_btsrp_df(n_ahead,oirf_draws,"disp_on_disp_")
plt_btstrp(btstrp_df) + ggtitle("SPF-Tealbook nowcast gap on SPF-Tealbook nowcast gap")
ggsave("figures/IRFs/SPFGBgap/SPFGBgap_SPFGBgap.pdf", width = 4, height = 3)
ggsave("figures/IRFs/SPFGBgap/SPFGBgap_SPFGBgap.pdf", width = 4, height = 3)
btstrp_df <- create_btsrp_df(n_ahead,oirf_draws,"disp_on_news_")
plt_btstrp(btstrp_df) + ggtitle("SPF-Tealbook nowcast gap on NYT focus")
ggsave("figures/IRFs/SPFGBgap/SPFGBgap_nyt.pdf", width = 4, height = 3)
btstrp_df <- create_btsrp_df(n_ahead,oirf_draws,"disp_on_fed_")
plt_btstrp(btstrp_df) + ggtitle("SPF-Tealbook nowcast gap on FOMC minutes focus")
ggsave("figures/IRFs/SPFGBgap/SPFGBgap_fomc.pdf", width = 4, height = 3)
btstrp_df <- create_btsrp_df(n_ahead,oirf_draws,"news_on_disp_")
plt_btstrp(btstrp_df) + ggtitle("NYT focus on SPF-Tealbook nowcast gap")
ggsave("figures/IRFs/SPFGBgap/nyt_SPFGBgap.pdf", width = 4, height = 3)
btstrp_df <- create_btsrp_df(n_ahead,oirf_draws,"news_on_news_")
plt_btstrp(btstrp_df) + ggtitle("NYT focus on NYT focus")
ggsave("figures/IRFs/SPFGBgap/nyt_nyt.pdf", width = 4, height = 3)
btstrp_df <- create_btsrp_df(n_ahead,oirf_draws,"news_on_fed_")
plt_btstrp(btstrp_df) + ggtitle("NYT focus on FOMC minutes focus")
ggsave("figures/IRFs/SPFGBgap/nyt_fomc.pdf", width = 4, height = 3)
btstrp_df <- create_btsrp_df(n_ahead,oirf_draws,"fed_on_disp_")
plt_btstrp(btstrp_df) + ggtitle("FOMC minutes focus on SPF-Tealbook nowcast gap")
ggsave("figures/IRFs/SPFGBgap/fomc_SPFGBgap.pdf", width = 4, height = 3)
btstrp_df <- create_btsrp_df(n_ahead,oirf_draws,"fed_on_news_")
plt_btstrp(btstrp_df) + ggtitle("FOMC minutes focus on NYT focus")
ggsave("figures/IRFs/SPFGBgap/fomc_nyt.pdf", width = 4, height = 3)
btstrp_df <- create_btsrp_df(n_ahead,oirf_draws,"fed_on_disp_")
plt_btstrp(btstrp_df) + ggtitle("FOMC minutes focus on SPF-Tealbook nowcast gap")
plt_btstrp(btstrp_df) + ggtitle("FOMC minutes focus on FOMC minutes focus")
btstrp_df <- create_btsrp_df(n_ahead,oirf_draws,"fed_on_fed_")
plt_btstrp(btstrp_df) + ggtitle("FOMC minutes focus on FOMC minutes focus")
btstrp_df <- create_btsrp_df(n_ahead,oirf_draws,"fed_on_fed_")
plt_btstrp(btstrp_df) + ggtitle("FOMC minutes focus on FOMC minutes focus")
ggsave("figures/IRFs/SPFGBgap/fomc_fomc.pdf", width = 4, height = 3)
btstrp_df <- create_btsrp_df(n_ahead,oirf_draws,"disp_on_disp_")
plt_btstrp(btstrp_df) + ggtitle("SPF-Fed nowcast gap on SPF-Fed nowcast gap")
ggsave("figures/IRFs/SPFGBgap/SPFGBgap_SPFGBgap.pdf", width = 4, height = 3)
#### Plot and save all the OIRFs
# Dispersion
btstrp_df <- create_btsrp_df(n_ahead,oirf_draws,"disp_on_disp_")
plt_btstrp(btstrp_df) + ggtitle("SPF-Fed gap on SPF-Fed gap")
ggsave("figures/IRFs/SPFGBgap/SPFGBgap_SPFGBgap.pdf", width = 4, height = 3)
btstrp_df <- create_btsrp_df(n_ahead,oirf_draws,"disp_on_news_")
plt_btstrp(btstrp_df) + ggtitle("SPF-Fed gap on NYT focus")
ggsave("figures/IRFs/SPFGBgap/SPFGBgap_nyt.pdf", width = 4, height = 3)
btstrp_df <- create_btsrp_df(n_ahead,oirf_draws,"disp_on_fed_")
plt_btstrp(btstrp_df) + ggtitle("SPF-Fed gap on FOMC minutes focus")
ggsave("figures/IRFs/SPFGBgap/SPFGBgap_fomc.pdf", width = 4, height = 3)
# News
btstrp_df <- create_btsrp_df(n_ahead,oirf_draws,"news_on_disp_")
plt_btstrp(btstrp_df) + ggtitle("NYT focus on SPF-Fed gap")
ggsave("figures/IRFs/SPFGBgap/nyt_SPFGBgap.pdf", width = 4, height = 3)
btstrp_df <- create_btsrp_df(n_ahead,oirf_draws,"news_on_news_")
plt_btstrp(btstrp_df) + ggtitle("NYT focus on NYT focus")
ggsave("figures/IRFs/SPFGBgap/nyt_nyt.pdf", width = 4, height = 3)
btstrp_df <- create_btsrp_df(n_ahead,oirf_draws,"news_on_fed_")
plt_btstrp(btstrp_df) + ggtitle("NYT focus on FOMC minutes focus")
ggsave("figures/IRFs/SPFGBgap/nyt_fomc.pdf", width = 4, height = 3)
# Fed
btstrp_df <- create_btsrp_df(n_ahead,oirf_draws,"fed_on_disp_")
plt_btstrp(btstrp_df) + ggtitle("FOMC minutes focus on SPF-Fed gap")
ggsave("figures/IRFs/SPFGBgap/fomc_SPFGBgap.pdf", width = 4, height = 3)
btstrp_df <- create_btsrp_df(n_ahead,oirf_draws,"fed_on_news_")
plt_btstrp(btstrp_df) + ggtitle("FOMC minutes focus on NYT focus")
ggsave("figures/IRFs/SPFGBgap/fomc_nyt.pdf", width = 4, height = 3)
btstrp_df <- create_btsrp_df(n_ahead,oirf_draws,"fed_on_fed_")
plt_btstrp(btstrp_df) + ggtitle("FOMC minutes focus on FOMC minutes focus")
ggsave("figures/IRFs/SPFGBgap/fomc_fomc.pdf", width = 4, height = 3)
####
# This file estimates topics on the Federal Reserve and NYT articles combined
####
setwd("~/Documents/GitHub/CBC_spillovers")
rm(list = ls())
library(stringr)
library(ggplot2)
library(ggwordcloud)
library(lfe)
library(plm)
library(fixest)
library(tidyverse)
library(Hmisc)
library(reshape2)
library(stargazer)
standardise <- function(x){
x <- (x - mean(x, na.rm = TRUE))/sd(x, na.rm = TRUE)
return(x)
}
felm_DK_se <- function(reg_formula, df_panel){
# Estimate regressions with feols and felm
model <- feols(reg_formula, data = df_panel)
model_felm <- felm(reg_formula, data = df_panel)
stopifnot(length(model_felm$se) ==
length(summary(model, vcov = DK ~ period)$coeftable[,"Std. Error"]))
model_felm$se <- summary(model, vcov = DK ~ period)$coeftable[,"Std. Error"]
model_felm$tval <- summary(model, vcov = DK ~ period)$coeftable[,"t value"]
model_felm$pval <- summary(model, vcov = DK ~ period)$coeftable[,"Pr(>|t|)"]
return(model_felm)
}
cor_mat_plot <- function(df, qual_vars){
# Create correlation matrix
cormat_hh <- rcorr(as.matrix(df[,qual_vars]))
# Coefs
cormat_hh_coef <- cormat_hh$r
cormat_hh_coef[upper.tri(cormat_hh_coef)] <- NA
diag(cormat_hh_coef) <- NA
cormat_hh_coef <- tibble(melt(cormat_hh_coef, na.rm = T, value.name = "coef")) %>%
filter(Var1 %in% qual_vars & Var2 %in% qual_vars) %>%
mutate(coef = round(coef,2))
# P-values
cormat_hh_pval <- cormat_hh$P
cormat_hh_pval[upper.tri(cormat_hh_pval)] <- NA
diag(cormat_hh_pval) <- NA
cormat_hh_pval <- tibble(melt(cormat_hh_pval, na.rm = T, value.name = "pval")) %>%
filter(Var1 %in% qual_vars & Var2 %in% qual_vars) %>%
mutate(alpha = case_when(pval < 0.1 ~ "sig", TRUE ~ "not")) %>%
mutate(stars = case_when(pval < 0.01 ~ "***", pval < 0.05 ~ "**", pval < 0.1 ~ "*", TRUE ~ ""))
# Merge back
cormat_hh <- left_join(cormat_hh_coef, cormat_hh_pval, by = c("Var1", "Var2"))
# Plot matrix
corplot_hh <- ggplot(cormat_hh, aes(x = (Var2), y = fct_rev(Var1), fill = coef)) + theme_minimal() +
geom_tile(color = "white") +
scale_fill_gradient2(low = "blue", high = "red", mid = "white",
midpoint = 0, limit = c(-1,1), space = "Lab") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.3, hjust=1)) +
labs(x = "", y = "", fill = "Correlation") +
geom_text(aes(label = str_c(signif(coef,3),stars), alpha = alpha), color = "black", size = 2.3) +
scale_alpha_manual(values = c("sig" = 1, "not" = 0.5), guide = 'none') +
ggtitle("")
return(corplot_hh)
}
col_theme <- scale_color_manual("Legend", values = c("FOMC minutes" = "darkblue",
"FOMC speeches" = "darkgreen",
"News articles" = "darkgrey"))
col_theme2 <- scale_color_manual("Legend", values = c("FOMC minutes" = "darkblue",
"SPF dispersion" = "firebrick",
"Tealbook update" = "darkcyan"))
#,"Tealbook error" = "darkgoldenrod3"))
# Import the minutes data estimated at the meeting level
import_filename <- "data/topics_forecasts_panel.csv"
panel_df <- read.csv(import_filename, encoding = "utf-8", stringsAsFactors = FALSE)
panel_df <- pdata.frame(panel_df, index = c("variable", "period"))
# Lags of mins
panel_df$mins_1lag <- plm::lag(panel_df$mins,1)
panel_df$mins_2lag <- plm::lag(panel_df$mins,2)
panel_df$mins_3lag <- plm::lag(panel_df$mins,3)
# Lags of speeches
panel_df$speeches_1lag <- plm::lag(panel_df$speeches,1)
panel_df$speeches_2lag <- plm::lag(panel_df$speeches,2)
panel_df$speeches_3lag <- plm::lag(panel_df$speeches,3)
# Lags of media
panel_df$news_1lag <- plm::lag(panel_df$news,1)
panel_df$news_2lag <- plm::lag(panel_df$news,2)
panel_df$news_3lag <- plm::lag(panel_df$news,3)
# Cut-off observations that don't have GB data
panel_df$quarter <- as.Date(panel_df$quarter)
panel_df <- panel_df[which(panel_df$quarter < "2017-01-01"),]
# Import the topic betas
import_filename <- "data/topic_data/overall/short_paragraph_topics_k29.csv"
topicwords_df <- read.csv(import_filename, encoding = "utf-8", stringsAsFactors = FALSE)
# Import the topic betas
import_filename <- "data/topic_data/short_topics_summary_k29.csv"
topicsummary_df <- read.csv(import_filename, encoding = "utf-8", stringsAsFactors = FALSE)
import_filename = "data/topics_qly_baseline.csv"
qly_series_df <- read.csv(import_filename, encoding = "utf-8", stringsAsFactors = FALSE)
qly_series_df$quarter <- as.Date(qly_series_df$quarter)
spf_gb_df <- read.csv("data/spf_gb_panel.csv", stringsAsFactors = FALSE)
spf_gb_df$quarter <- as.Date(spf_gb_df$quarter)
spf_gb_df <- pivot_wider(spf_gb_df, id_cols = c(quarter), names_from = variable,
names_glue = "{variable}_{.value}",
values_from = c(variable_act, dispersion, GB_update_abs_std,
GB_now_error_abs, GB_SPF_now_gap_abs_std))
qly_series_df <- merge(qly_series_df[,which(!str_detect(names(qly_series_df), "disper"))],
spf_gb_df, by = "quarter")
qly_series_df$quarter <- as.Date(qly_series_df$quarter)
variables <- as.character(unique(panel_df$variable))
variables_gb <- as.character(unique(filter(panel_df, !is.na(GB_update_abs_std))$variable))
"
Check correlations
"
# Residualise errors against a time fixed effect
resids_df <- panel_df[which(!is.na(panel_df$GB_update_abs_std)),]
model <- feols(GB_update_abs_std ~ 0 | variable + period, resids_df)
resids_df$GB_update_abs_resids <- model$residuals
update_df <- resids_df %>%
pivot_wider(id_cols = quarter, names_from = variable, values_from = GB_update_abs_resids)
cor_mat_plot(update_df, variables_gb)
est_df <- panel_df %>%
mutate(GB_update_abs_std = replace_na(GB_update_abs_std,0),
GB_SPF_error_diff_std = replace_na(GB_SPF_error_diff_std,0),
GB_SPF_now_gap_abs_std = replace_na(GB_SPF_now_gap_abs_std,0)) %>%
rbind(mutate(panel_df, variable = "Overall")) %>%
pivot_longer(cols = c(mins_std, speeches_std, news_std), names_to = "text", values_to = "focus") %>%
mutate(text = case_when(str_detect(text, "mins") ~ "FOMC Minutes", str_detect(text, "speech") ~ "FOMC Speeches",
str_detect(text, "news") ~ "NYT articles")) %>%
group_by(variable, text) %>%
summarise(`disp` = cor.test(focus, disp_std, na.rm = T)$estimate,
`s` = case_when(any(!is.na(GB_nowcast)) ~ cor.test(focus, GB_update_abs_std, na.rm = T)$estimate, TRUE ~ NA_real_),
`nu` = case_when(any(!is.na(GB_nowcast)) ~ cor.test(focus, GB_SPF_error_diff_std, na.rm = T)$estimate, TRUE ~ NA_real_),
`varepsilon` = case_when(any(!is.na(GB_nowcast)) ~ cor.test(focus, GB_SPF_now_gap_abs_std, na.rm = T)$estimate, TRUE ~ NA_real_)) %>%
pivot_longer(cols = c(-variable, -text), values_to = "coef", names_to = "correlation")
# p-vals
pval_df <- panel_df %>%
mutate(GB_update_abs_std = replace_na(GB_update_abs_std,0),
GB_SPF_error_diff_std = replace_na(GB_SPF_error_diff_std,0),
GB_SPF_now_gap_abs_std = replace_na(GB_SPF_now_gap_abs_std,0)) %>%
rbind(mutate(panel_df, variable = "Overall")) %>%
pivot_longer(cols = c(mins_std, speeches_std, news_std), names_to = "text", values_to = "focus") %>%
mutate(text = case_when(str_detect(text, "mins") ~ "FOMC Minutes", str_detect(text, "speech") ~ "FOMC Speeches",
str_detect(text, "news") ~ "NYT articles")) %>%
group_by(variable, text) %>%
summarise(`disp` = cor.test(focus, disp_std, na.rm = T)$p.value,
`s` = case_when(any(!is.na(GB_nowcast)) ~ cor.test(focus, GB_update_abs_std, na.rm = T)$p.value, TRUE ~ NA_real_),
`nu` = case_when(any(!is.na(GB_nowcast)) ~ cor.test(focus, GB_SPF_error_diff_std, na.rm = T)$p.value, TRUE ~ NA_real_),
`varepsilon` = case_when(any(!is.na(GB_nowcast)) ~ cor.test(focus, GB_SPF_now_gap_abs_std, na.rm = T)$p.value, TRUE ~ NA_real_)) %>%
pivot_longer(cols = c(-variable, -text), values_to = "pval", names_to = "correlation")
# Create correlation matrix
cormat_df <- left_join(est_df, pval_df, by = c("variable", "text", "correlation")) %>%
mutate(variable = factor(variable, levels = c(variables, "Overall"), ordered = T)) %>%
mutate(correlation = factor(correlation, levels = c("disp", "s", "varepsilon", "nu"), ordered = T))
cormat_df %>%
filter(!is.na(coef)) %>%
mutate(alpha = case_when(pval < 0.1 ~ "sig", TRUE ~ "not")) %>%
mutate(stars = case_when(pval < 0.01 ~ "***", pval < 0.05 ~ "**", pval < 0.1 ~ "*", TRUE ~ "")) %>%
ggplot(aes(x = correlation, y = fct_rev(variable), fill = coef)) + theme_minimal() +
facet_wrap(~text) +
scale_x_discrete(labels=c(expression(disp[kt]^SPF),
expression(paste("|",s[kt] - q[kt],"|")),
expression(paste("|",epsilon[kt]^GB,"|")),
expression(paste("|",nu[kt]^GB,"|")))) +
geom_tile(color = "white") +
scale_fill_gradient2(low = "blue", high = "red", mid = "white",
midpoint = 0, limit = c(-1,1), space = "Lab") +
#theme(axis.text.x = element_text(angle = 90, vjust = 0.3, hjust=1)) +
labs(x = "", y = "", fill = "Correlation") +
geom_text(aes(label = str_c(signif(coef,3),stars), alpha = alpha), color = "black", size = 2.3) +
scale_alpha_manual(values = c("sig" = 1, "not" = 0.5), guide = 'none')
cormat_df %>%
filter(!is.na(coef)) %>%
mutate(alpha = case_when(pval < 0.1 ~ "sig", TRUE ~ "not")) %>%
mutate(stars = case_when(pval < 0.01 ~ "***", pval < 0.05 ~ "**", pval < 0.1 ~ "*", TRUE ~ "")) %>%
ggplot(aes(x = correlation, y = fct_rev(variable), fill = coef)) + theme_minimal() +
facet_wrap(~text)
cormat_df %>%
filter(!is.na(coef)) %>%
mutate(alpha = case_when(pval < 0.1 ~ "sig", TRUE ~ "not")) %>%
mutate(stars = case_when(pval < 0.01 ~ "***", pval < 0.05 ~ "**", pval < 0.1 ~ "*", TRUE ~ "")) %>%
ggplot(aes(x = correlation, y = fct_rev(variable), fill = coef)) + theme_minimal() +
facet_wrap(~text) +
scale_x_discrete(labels=c(expression(disp[kt]^SPF),
expression(paste("|",s[kt],"|")),
expression(paste("|",s[kt]-q[kt],"|")),
expression(paste("|",sigma^CB-sigma^SPF,"|"))))
cormat_df %>%
filter(!is.na(coef)) %>%
mutate(alpha = case_when(pval < 0.1 ~ "sig", TRUE ~ "not")) %>%
mutate(stars = case_when(pval < 0.01 ~ "***", pval < 0.05 ~ "**", pval < 0.1 ~ "*", TRUE ~ "")) %>%
ggplot(aes(x = correlation, y = fct_rev(variable), fill = coef)) + theme_minimal() +
facet_wrap(~text) +
scale_x_discrete(labels=c(expression(disp[kt]^SPF),
expression(paste("|",s[kt],"|")),
expression(paste("|",s[kt]-q[kt],"|")),
expression(paste("|",sigma^CB-sigma^SPF,"|")))) +
geom_tile(color = "white") +
scale_fill_gradient2(low = "blue", high = "red", mid = "white",
midpoint = 0, limit = c(-1,1), space = "Lab") +
#theme(axis.text.x = element_text(angle = 90, vjust = 0.3, hjust=1)) +
labs(x = "", y = "", fill = "Correlation") +
geom_text(aes(label = str_c(signif(coef,3),stars), alpha = alpha), color = "black", size = 2.3) +
scale_alpha_manual(values = c("sig" = 1, "not" = 0.5), guide = 'none')
ggsave(paste0("figures/fed_media_topics/correlations.pdf"), width = 9, height = 4)
# Plot matrix
cormat_df %>%
filter(!is.na(coef)) %>%
mutate(alpha = case_when(pval < 0.1 ~ "sig", TRUE ~ "not")) %>%
mutate(stars = case_when(pval < 0.01 ~ "***", pval < 0.05 ~ "**", pval < 0.1 ~ "*", TRUE ~ "")) %>%
ggplot(aes(x = correlation, y = fct_rev(variable), fill = coef)) + theme_minimal() +
facet_wrap(~text) +
scale_x_discrete(labels=c(expression(disp[kt]^SPF),
expression(paste("|",s[kt],"|")),
expression(paste("|",s[kt]-q[kt],"|")),
expression(paste("|",sigma^CB-sigma^PS,"|")))) +
geom_tile(color = "white") +
scale_fill_gradient2(low = "blue", high = "red", mid = "white",
midpoint = 0, limit = c(-1,1), space = "Lab") +
#theme(axis.text.x = element_text(angle = 90, vjust = 0.3, hjust=1)) +
labs(x = "", y = "", fill = "Correlation") +
geom_text(aes(label = str_c(signif(coef,3),stars), alpha = alpha), color = "black", size = 2.3) +
scale_alpha_manual(values = c("sig" = 1, "not" = 0.5), guide = 'none')
ggsave(paste0("figures/fed_media_topics/correlations.pdf"), width = 9, height = 4)
